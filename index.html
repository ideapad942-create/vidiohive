<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>AI Video Metadata Generator (VISION)</title>
<style>
body{font-family:Segoe UI,sans-serif;background:#fdf2f8;padding:20px}
.container{max-width:1000px;margin:auto;background:#fff;border-radius:16px;padding:20px}
button,input{padding:12px;width:100%;margin-bottom:10px}
table{width:100%;border-collapse:collapse}
td,th{padding:8px;border-bottom:1px solid #ddd;font-size:12px}
.thumb{width:80px;height:50px;object-fit:cover}
</style>
</head>
<body>

<div class="container">
<h3>ğŸ”‘ OpenAI API Key</h3>
<input id="key" placeholder="sk-xxxxx">
<button onclick="save()">Simpan</button>

<h3>ğŸ“ Folder Video</h3>
<input type="file" id="folder" webkitdirectory multiple>
<button onclick="prepare()">Scan</button>

<h3>âš™ï¸ Proses</h3>
<button onclick="run()">Mulai</button>

<table>
<thead><tr><th>Preview</th><th>File</th><th>Status</th></tr></thead>
<tbody id="list"></tbody>
</table>

<button onclick="csv()">â¬‡ CSV</button>
</div>

<video id="v" muted style="display:none"></video>
<canvas id="c" style="display:none"></canvas>

<script>
let files=[],out=[];
const PROMPT=`Analyze these 3 frames from ONE video.
Generate microstock metadata.

TITLE: max 70 chars
DESCRIPTION: ~150 chars
KEYWORDS: EXACTLY 45 single words
MUST include: film, burn

Return JSON only:
{"title":"","description":"","keywords":""}`;

function save(){localStorage.key=key.value}

function prepare(){
files=[...folder.files].filter(f=>/\.(mp4|mov|avi)$/i.test(f.name));
list.innerHTML="";
files.forEach((f,i)=>{
list.innerHTML+=`<tr id="r${i}"><td>-</td><td>${f.name}</td><td>Pending</td></tr>`;
});
}

async function frames(file){
return new Promise(res=>{
const v=document.getElementById("v"),c=document.getElementById("c"),x=c.getContext("2d");
v.src=URL.createObjectURL(file);v.load();
v.onloadedmetadata=async()=>{
let arr=[];
for(let p of [0.05,0.5,0.95]){
v.currentTime=v.duration*p;
await new Promise(r=>v.onseeked=r);
c.width=640;c.height=360;x.drawImage(v,0,0,640,360);
arr.push(c.toDataURL("image/jpeg",0.7));
}
res(arr);
};
});
}

async function run(){
for(let i=0;i<files.length;i++){
let r=document.getElementById("r"+i);
r.cells[2].innerText="Snapshot...";
let imgs=await frames(files[i]);
r.cells[0].innerHTML=`<img class="thumb" src="${imgs[1]}">`;
r.cells[2].innerText="AI...";

let res=await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{
"Authorization":"Bearer "+localStorage.key,
"Content-Type":"application/json"
},
body:JSON.stringify({
model:"gpt-4o-mini",
messages:[
{role:"system",content:PROMPT},
{role:"user",content:imgs.map(i=>({type:"image_url",image_url:{url:i}}))}
],
temperature:0.2
})
});
let j=await res.json();
let d=JSON.parse(j.choices[0].message.content);

out.push({file:files[i].name,...d});
r.cells[2].innerText="DONE";
}
}

function csv(){
let s="filename,title,description,keywords\n";
out.forEach(o=>{
s+=`"${o.file}","${o.title}","${o.description}","${o.keywords}"\n`;
});
let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([s]));
a.download="video_metadata.csv";a.click();
}
</script>
</body>
</html>
